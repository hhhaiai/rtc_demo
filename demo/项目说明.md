# Phoenix RTC Demo - 项目说明

## 📋 项目概述

这是一个基于 **WebRTC** 的实时音视频通信演示项目，包含三个完整的演示页面，全部使用**真实的 P2P 连接**，而非模拟视频。

---

## 🎯 核心特性

### ✅ 真实 P2P 连接
- 使用真实的摄像头和麦克风
- 端到端加密通信
- 支持 NAT 穿透（STUN 服务器）

### ✅ 三种使用场景
1. **1对1视频通话** - 无需服务器，手动信令交换
2. **多人视频会议** - 需要信令服务器，自动连接
3. **实时直播** - 主播/观众模式，支持互动

### ✅ 完整的 WebRTC 流程
- 媒体获取（getUserMedia）
- 信令交换（Offer/Answer）
- ICE 候选收集
- 连接建立与维护

---

## 📁 文件结构

```
demo/
├── 1_video_call.html              # 1对1视频通话（手动信令）
├── 2_multi_person_meeting.html    # 多人会议（信令服务器）
├── 3_live_streaming.html          # 直播+互动（信令服务器）
├── signaling-server.js            # Node.js 信令服务器
├── start.sh                       # Mac/Linux 启动脚本
├── start_server.bat               # Windows 启动脚本
├── README.md                      # 详细使用指南
├── 快速开始.txt                   # 快速参考卡片
└── 项目说明.md                    # 本文件
```

---

## 🚀 快速开始

### 方式一：一键启动（推荐）

**Mac/Linux:**
```bash
cd /Users/sanbo/Desktop/rtc_demo/demo
bash start.sh
```

**Windows:**
```bash
双击 start_server.bat
```

### 方式二：手动启动

```bash
cd /Users/sanbo/Desktop/rtc_demo/demo
python -m http.server 8000
```

然后在浏览器访问：`http://localhost:8000`

---

## 📖 各页面详细说明

### 1️⃣ 1_video_call.html - 视频通话

**适用场景：** 快速测试 P2P 连接，无需服务器

**工作原理：**
```
用户A → 创建Offer → 复制信令 → 发送给用户B
用户B → 粘贴Offer → 创建Answer → 复制信令 → 发送给用户A
用户A → 粘贴Answer → 建立连接
```

**操作步骤：**
1. 两个浏览器打开此页面
2. A方：输入用户名 → 点击"初始化连接"
3. A方：点击"创建Offer" → 复制生成的信令
4. B方：输入用户名 → 点击"初始化连接"
5. B方：粘贴A的Offer → 点击"创建Answer" → 复制Answer
6. A方：粘贴B的Answer → 点击"完成连接"

**特点：**
- ✅ 无需任何服务器
- ✅ 适合学习 WebRTC 原理
- ✅ 支持音频/视频开关
- ✅ 显示实时统计信息

---

### 2️⃣ 2_multi_person_meeting.html - 多人会议

**适用场景：** 团队视频会议，多人同时在线

**工作原理：**
```
用户A → 加入房间 → 信令服务器 → 通知用户B
用户B → 加入房间 → 信令服务器 → 通知用户A
信令服务器 → 交换Offer/Answer → 建立P2P连接
```

**操作步骤：**
1. 启动信令服务器：`node signaling-server.js`
2. 所有用户：输入用户名、房间号、服务器地址（`ws://localhost:8080`）
3. 点击"加入房间"
4. 系统自动连接所有在线用户

**特点：**
- ✅ 支持多人同时在线
- ✅ 自动连接新加入的用户
- ✅ 显示参与者列表
- ✅ 实时统计信息

---

### 3️⃣ 3_live_streaming.html - 直播互动

**适用场景：** 直播演示，带评论和互动

**工作原理：**
```
主播 → 开启摄像头 → 推流到信令服务器
观众 → 加入直播间 → 信令服务器 → 接收主播流
所有人 → 通过信令服务器交换评论/点赞/礼物
```

**操作步骤：**

**主播端：**
1. 选择"主播模式"
2. 输入用户名、直播间号、服务器地址
3. 点击"开始直播"
4. 等待观众加入

**观众端：**
1. 选择"观众模式"
2. 输入用户名、相同的直播间号、服务器地址
3. 点击"进入直播间"
4. 观看直播，发送评论

**特点：**
- ✅ 主播/观众模式切换
- ✅ 浮动评论（从左到右飘过）
- ✅ 点赞动画（❤️）
- ✅ 礼物特效（🎁）
- ✅ 实时互动

---

## 🔧 信令服务器

### 安装与启动

```bash
# 安装依赖
npm install ws

# 启动服务器
node signaling-server.js
```

### 服务器功能

- ✅ 房间管理
- ✅ 用户加入/离开通知
- ✅ SDP 交换（Offer/Answer）
- ✅ ICE 候选转发
- ✅ 评论/点赞/礼物广播

### 消息类型

| 消息类型 | 发送方 | 接收方 | 用途 |
| :--- | :--- | :--- | :--- |
| `join` | 客户端 | 服务器 | 加入房间 |
| `peerJoined` | 服务器 | 所有人 | 新用户加入 |
| `offer` | 客户端 | 指定用户 | 发起连接 |
| `answer` | 客户端 | 指定用户 | 应答连接 |
| `iceCandidate` | 客户端 | 指定用户 | ICE 候选 |
| `comment` | 客户端 | 所有人 | 评论 |
| `like` | 客户端 | 所有人 | 点赞 |
| `gift` | 客户端 | 所有人 | 礼物 |

---

## 🌐 网络要求

### 必须使用 localhost

WebRTC 安全策略要求：
- ✅ `http://localhost:8000`
- ✅ `http://127.0.0.1:8000`
- ❌ `file://` 协议（直接双击文件）
- ❌ IP 地址（如 `http://192.168.1.100:8000`）

**为什么？**
- 浏览器要求 HTTPS 或 localhost 才能访问摄像头
- 直接打开文件无法获得摄像头权限

### 移动端访问

如果要在手机上测试：

1. **电脑启动服务器**
   ```bash
   python -m http.server 8000
   ```

2. **查看电脑 IP**
   ```bash
   # Mac/Linux
   ifconfig | grep "inet "

   # Windows
   ipconfig
   ```

3. **手机访问**
   - 确保手机和电脑在同一 WiFi
   - 手机浏览器输入：`http://[电脑IP]:8000/1_video_call.html`
   - 例如：`http://192.168.1.100:8000/1_video_call.html`

---

## 🔍 常见问题

### Q1: 为什么提示 "undefined is not an object"？

**原因：** 未使用 localhost 访问，或浏览器不支持 WebRTC

**解决：**
1. 确保访问地址是 `http://localhost:8000`
2. 检查浏览器是否支持 WebRTC
3. 允许摄像头权限

### Q2: Chrome 提示 "不安全"？

**原因：** Chrome 对摄像头权限的限制

**解决：**
1. 点击地址栏左侧的"不安全"图标
2. 选择"允许"或"网站设置"
3. 将摄像头权限设为"允许"

### Q3: 两个浏览器看不到对方？

**原因：** 信令服务器未启动或配置错误

**解决：**
1. 检查信令服务器是否运行：`node signaling-server.js`
2. 检查服务器地址是否正确：`ws://localhost:8080`
3. 检查房间号是否一致
4. 按 F12 查看控制台错误

### Q4: 移动端无法打开？

**原因：** 浏览器限制

**解决：**
- iOS：使用 Safari
- 微信：选择"在浏览器打开"
- Android：使用 Chrome

---

## 📊 技术栈

| 技术 | 用途 |
| :--- | :--- |
| **WebRTC** | 实时音视频通信核心 |
| **WebSocket** | 信令服务器通信 |
| **STUN** | NAT 穿透，获取公网 IP |
| **HTML5** | 页面结构 |
| **CSS3** | 样式和动画 |
| **JavaScript** | 逻辑控制 |

---

## 🎓 学习建议

### 初学者路径

1. **第一步：** 运行 `1_video_call.html`
   - 理解 WebRTC 基本流程
   - 了解 Offer/Answer 交换
   - 熟悉 ICE 候选

2. **第二步：** 搭建信令服务器
   - 学习 WebSocket 通信
   - 理解消息路由

3. **第三步：** 测试 `2_multi_person_meeting.html`
   - 理解多人连接逻辑
   - 学习 PeerConnection 管理

4. **第四步：** 体验 `3_live_streaming.html`
   - 理解直播架构
   - 学习实时互动

---

## 📝 代码结构

### 1_video_call.html 核心流程

```javascript
// 1. 初始化
initConnection() → getUserMedia() → createPeerConnection()

// 2. A方创建Offer
createOffer() → setLocalDescription() → 生成信令

// 3. B方处理Offer
setRemoteDescription(offer) → createAnswer() → 生成Answer

// 4. A方处理Answer
setRemoteDescription(answer) → 连接建立

// 5. ICE 候选交换
onicecandidate → 交换候选 → addIceCandidate()
```

### 2_multi_person_meeting.html 核心流程

```javascript
// 1. 连接信令服务器
connectSignalingServer() → WebSocket

// 2. 加入房间
ws.send({type: 'join', username, roomId})

// 3. 新用户加入
on peerJoined → createOfferToUser() → 发送Offer

// 4. 收到Offer
on offer → handleOffer() → 创建Answer → 发送Answer

// 5. 收到Answer
on answer → handleAnswer() → 完成连接

// 6. ICE 候选
on iceCandidate → handleIceCandidate()
```

---

## 🔄 更新记录

**2025-12-26**
- ✅ 重写所有页面为真实 P2P 连接
- ✅ 移除所有虚拟视频内容
- ✅ 增加环境检测和错误提示
- ✅ 优化移动端兼容性
- ✅ 添加信令服务器示例
- ✅ 完善文档和快速指南

---

## 📞 技术支持

如遇到问题，请按以下顺序排查：

1. **检查访问地址**：必须是 `http://localhost:8000`
2. **检查摄像头权限**：浏览器是否允许访问
3. **检查控制台错误**：按 F12 查看
4. **检查信令服务器**：多人功能需要服务器运行
5. **查看 README.md**：详细故障排查指南

---

## 🎉 总结

本项目提供了一个完整的 WebRTC P2P 通信演示，包含：
- ✅ 3 个真实场景的演示页面
- ✅ 完整的信令服务器实现
- ✅ 详细的文档和快速指南
- ✅ 启动脚本（Mac/Windows）
- ✅ 故障排查指南

**所有功能都基于真实的 WebRTC P2P 连接，适合学习和测试！**

---

**祝使用愉快！** 🚀
