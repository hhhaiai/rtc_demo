# 🧪 Phoenix RTC Demo - 测试指南

## 📋 测试前准备

### 1. 启动服务器
```bash
cd /Users/sanbo/Desktop/rtc_demo/demo
bash start.sh
```

或者手动启动：
```bash
python -m http.server 8000
```

### 2. 浏览器访问
打开浏览器访问：`http://localhost:8000`

---

## 🎯 三个演示页面的测试方法

### 1️⃣ 1_video_call.html - 1对1视频通话（手动信令）

**特点**：无需服务器，纯手动交换信令

**测试步骤（需要2个浏览器窗口）**：

**窗口A（发起方）**：
1. 输入用户名（如：`UserA`）
2. 点击"开始通话"（允许摄像头权限）
3. 点击"🎯 创建连接" → 信令会自动复制
4. 将信令发给B（通过微信、QQ等）

**窗口B（接收方）**：
1. 输入用户名（如：`UserB`）
2. 点击"开始通话"（允许摄像头权限）
3. 粘贴A的信令到"粘贴对方的信令"
4. 点击"🎯 加入通话" → 信令会自动复制
5. 将信令发回给A

**窗口A**：
1. 粘贴B的信令
2. 点击"✅ 完成连接"
3. 等待连接建立（约1-3秒）

**✅ 成功标志**：双方都能看到对方的视频画面

---

### 2️⃣ 2_multi_person_meeting.html - 多人会议（信令服务器）

**特点**：需要信令服务器，支持多人自动连接

**测试前准备**：
```bash
# 在demo目录下启动信令服务器
npm install ws  # 首次使用需要安装
node signaling-server.js
```

**测试步骤（需要2-3个浏览器窗口）**：

**所有窗口**：
1. 输入服务器地址：`ws://localhost:8080`
2. 输入用户名（如：`UserA`, `UserB`, `UserC`）
3. 输入相同的房间号（如：`1001`）
4. 点击"加入房间"

**✅ 成功标志**：
- 新用户加入时，所有人都能看到新用户
- 每个人都能看到所有其他人的视频
- 参与者列表显示所有用户

**常见问题排查**：
- 如果看不到其他人：检查信令服务器是否运行
- 按F12查看控制台日志

---

### 3️⃣ 3_live_streaming.html - 直播+互动

**特点**：主播/观众模式，支持浮动评论、点赞、礼物

**测试前准备**：
```bash
# 同样需要启动信令服务器
node signaling-server.js
```

**测试步骤（需要2个浏览器窗口）**：

**窗口A（主播）**：
1. 输入服务器地址：`ws://localhost:8080`
2. 输入用户名（如：`Broadcaster`）
3. 输入直播间号（如：`live1001`）
4. 点击"🎤 主播模式"
5. 允许摄像头权限

**窗口B（观众）**：
1. 输入服务器地址：`ws://localhost:8080`
2. 输入用户名（如：`Viewer1`）
3. 输入相同的直播间号（`live1001`）
4. 点击"👁️ 观众模式"

**互动测试**：
- **评论**：在观众窗口输入评论，回车发送
- **点赞**：点击❤️按钮，会看到心形动画
- **礼物**：点击🎁按钮，会看到礼物特效
- **浮动评论**：评论会从屏幕左侧飘到右侧

**✅ 成功标志**：
- 观众能看到主播的实时画面
- 评论、点赞、礼物在双方窗口都能看到
- 浮动评论动画正常

---

## 🔧 常见问题解决

### 问题1：浏览器提示"无法访问摄像头"
**原因**：未使用localhost或未允许权限
**解决**：
- 确保访问地址是 `http://localhost:8000`
- 点击地址栏左侧的锁图标，允许摄像头权限
- 刷新页面重新请求

### 问题2：信令服务器连接失败
**原因**：服务器未启动或端口被占用
**解决**：
```bash
# 检查服务器是否运行
lsof -i :8080

# 杀掉占用端口的进程
kill -9 $(lsof -t -i:8080)

# 重新启动
node signaling-server.js
```

### 问题3：两个浏览器看不到对方
**原因**：ICE连接失败（NAT穿透问题）
**解决**：
- 确保两个浏览器都在同一网络
- 检查防火墙设置
- 查看控制台是否有错误信息

### 问题4：移动端无法打开
**原因**：Chrome限制非localhost访问摄像头
**解决**：
1. 电脑启动服务器：`python -m http.server 8000`
2. 查看电脑IP：`ifconfig | grep "inet "`
3. 手机访问：`http://[电脑IP]:8000/1_video_call.html`
4. 手机和电脑必须在同一WiFi

---

## 📊 测试检查清单

### 1_video_call.html
- [ ] 能正常获取摄像头权限
- [ ] 能生成Offer信令
- [ ] 能自动复制信令
- [ ] 能解析远程Offer
- [ ] 能生成Answer信令
- [ ] 能完成连接
- [ ] 双方能看到视频

### 2_multi_person_meeting.html
- [ ] 能连接信令服务器
- [ ] 能加入房间
- [ ] 能看到自己
- [ ] 新用户加入时能看到
- [ ] 能看到所有远程用户
- [ ] 参与者列表正确显示

### 3_live_streaming.html
- [ ] 主播能开启摄像头
- [ ] 观众能连接到主播
- [ ] 观众能看到主播画面
- [ ] 评论功能正常
- [ ] 浮动评论动画正常
- [ ] 点赞动画正常
- [ ] 礼物动画正常
- [ ] 所有人都能看到互动

---

## 💡 测试建议

### 快速测试顺序
1. 先测试 `1_video_call.html`（最简单，无需服务器）
2. 启动信令服务器
3. 测试 `2_multi_person_meeting.html`（多人会议）
4. 测试 `3_live_streaming.html`（直播互动）

### 网络环境要求
- ✅ 推荐：同一局域网（WiFi）
- ⚠️ 可能有问题：不同网络（需要STUN穿透）
- ❌ 不支持：直接IP访问（Chrome限制）

### 浏览器推荐
- ✅ Chrome（最新版）
- ✅ Edge（最新版）
- ✅ Safari（iOS/Mac）
- ❌ 不推荐：老旧浏览器

---

## 🎓 学习要点

通过测试这三个页面，你可以理解：
1. **WebRTC基础**：getUserMedia, RTCPeerConnection
2. **信令交换**：Offer/Answer流程
3. **P2P连接**：ICE候选交换
4. **多人连接**：Mesh网络架构
5. **直播架构**：一对多P2P
6. **实时互动**：WebSocket消息广播

祝测试愉快！🎉
